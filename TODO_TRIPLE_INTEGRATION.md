# 三目录联动优化任务跟踪

> 创建时间: 2026-01-21  
> 任务目标: 优化 web/api/scripts 三目录联动，确保功能执行力

---

## 📋 任务清单

### ☐ 任务1: 分析当前结构 ✅ 已完成

- [x] 分析 web/ 目录结构
- [x] 分析 api/ 目录结构
- [x] 分析 scripts/ 目录结构
- [x] 识别联动关系
- 开始时间: 2026-01-21
- 结束时间: 2026-01-21
- 状态: ✅ 已完成

### ☐ 任务2: 优化 api_mapping.json ✅ 已完成

- [x] 添加功能卡片规范字段
- [x] 完善状态/指标/行为/日志定义
- [x] 添加scripts完整映射
- [x] 添加状态监控API (health)
- [x] 添加日志获取API (logs)
- 开始时间: 2026-01-21
- 结束时间: 2026-01-21
- 状态: ✅ 已完成

### ☐ 任务3: 优化 web/ 前端渲染 [进行中]

- [ ] 优化 ws-manager.js WebSocket连接
- [ ] 创建 dynamicCardRenderer.js 动态卡片渲染器
- [ ] 优化 monitor.js 数据驱动UI
- [ ] 添加功能卡片动态渲染逻辑

### ☐ 任务4: 优化 scripts/ 脚本配置

- [ ] 完善 scripts_config.json
- [ ] 添加状态/指标/行为/日志描述
- [ ] 确保所有脚本可被API调用

### ☐ 任务5: 验证三目录联动

- [ ] 验证 Web → API → Scripts 调用链
- [ ] 验证功能卡片渲染
- [ ] 验证实时通信
- [ ] 验证脚本执行

---

## 🔗 三目录联动架构

```
web/ (前端渲染层)
    │
    ├── 获取 api/mapping/api_mapping.json
    ├── WebSocket 连接 api/backend/
    ├── 动态渲染功能卡片
    │
    ↓ 调用
    │
api/ (API网关层)
    │
    ├── 暴露统一API接口
    ├── 映射 scripts/ 脚本
    ├── 提供 状态/指标/日志/控制
    │
    ↓ 调用
    │
scripts/ (自动化执行层)
    │
    ├── 真实脚本执行
    ├── 健康检查
    ├── 部署管理
    └── 返回执行结果
```

---

## 📋 功能卡片规范

每个功能模块卡片必须显示：

- [ ] 冒泡检测 (bubbleDetection)
- [ ] 前端功能名称 (frontendName)
- [ ] 一句话功能说明 (description)
- [ ] 输入参数区域 (inputParameters - 动态生成)
- [ ] 后端预留节点 (backendEndpoint)
- [ ] 优化建议 (optimization)
- [ ] 功能标签 (tags: 功能具体说明/API接口/脚本运行逻辑/DAG)
- [ ] 状态标识 (🟢可用 / 🟡部分完成 / 🔴未部署)

---

## 📊 实时通信规范

| 场景     | 通信方式     | 端点    |
| -------- | ------------ | ------- |
| 普通状态 | HTTP API轮询 | /api/\* |
| 实时变化 | WebSocket    | /ws     |
| 降级方案 | SSE          | /sse    |

---

## 🚀 启动命令

```bash
# 启动Web监控中心
python web/start_monitor.py --auto-install

# 访问地址
# http://localhost:8080
```

---

## 📝 执行记录

### 执行时间: 2026-01-21

#### 任务1进度: [待开始]

- 开始时间: -
- 结束时间: -
- 状态: 待执行

#### 任务2进度: [待开始]

- 开始时间: -
- 结束时间: -
- 状态: 待执行

#### 任务3进度: [待开始]

- 开始时间: -
- 结束时间: -
- 状态: 待执行

#### 任务4进度: [待开始]

- 开始时间: -
- 结束时间: -
- 状态: 待执行

#### 任务5进度: [待开始]

- 开始时间: -
- 结束时间: -
- 状态: 待执行

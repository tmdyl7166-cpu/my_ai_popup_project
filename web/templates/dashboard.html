<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI弹窗项目监控中心</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <link href="/static/css/monitor.css" rel="stylesheet" />
  </head>
  <body>
    <nav class="navbar navbar-dark bg-dark">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">
          <i class="fas fa-cogs"></i> AI弹窗项目监控中心
        </a>
        <div class="d-flex">
          <span class="navbar-text me-3" id="status-indicator">
            <i class="fas fa-circle text-success"></i> 系统正常
          </span>
          <button class="btn btn-outline-light btn-sm" onclick="refreshAll()">
            <i class="fas fa-sync-alt"></i> 刷新
          </button>
        </div>
      </div>
    </nav>

    <div class="container-fluid mt-4">
      <div class="row">
        <!-- 系统状态卡片 -->
        <div class="col-md-3">
          <div class="card">
            <div class="card-header">
              <h5 class="card-title mb-0">
                <i class="fas fa-server"></i> 系统状态
              </h5>
            </div>
            <div class="card-body">
              <div class="mb-3">
                <label class="form-label">CPU使用率</label>
                <div class="progress">
                  <div
                    class="progress-bar"
                    id="cpu-progress"
                    role="progressbar"
                    style="width: 0%"
                  ></div>
                </div>
                <small class="text-muted" id="cpu-text">0%</small>
              </div>
              <div class="mb-3">
                <label class="form-label">内存使用率</label>
                <div class="progress">
                  <div
                    class="progress-bar bg-info"
                    id="memory-progress"
                    role="progressbar"
                    style="width: 0%"
                  ></div>
                </div>
                <small class="text-muted" id="memory-text">0%</small>
              </div>
              <div class="mb-3">
                <label class="form-label">磁盘使用率</label>
                <div class="progress">
                  <div
                    class="progress-bar bg-warning"
                    id="disk-progress"
                    role="progressbar"
                    style="width: 0%"
                  ></div>
                </div>
                <small class="text-muted" id="disk-text">0%</small>
              </div>
            </div>
          </div>
        </div>

        <!-- 项目状态卡片 -->
        <div class="col-md-6">
          <div class="card">
            <div
              class="card-header d-flex justify-content-between align-items-center"
            >
              <h5 class="card-title mb-0">
                <i class="fas fa-project-diagram"></i> 项目状态
              </h5>
              <button class="btn btn-primary btn-sm" onclick="runHealthCheck()">
                <i class="fas fa-stethoscope"></i> 健康检查
              </button>
            </div>
            <div class="card-body">
              <div id="projects-container">
                <!-- 项目卡片将在这里动态生成 -->
                <div class="text-center text-muted">
                  <i class="fas fa-spinner fa-spin"></i> 加载中...
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 脚本管理卡片 -->
        <div class="col-md-3">
          <div class="card">
            <div class="card-header">
              <h5 class="card-title mb-0">
                <i class="fas fa-terminal"></i> 脚本管理
              </h5>
            </div>
            <div class="card-body">
              <div id="scripts-container">
                <!-- 脚本列表将在这里动态生成 -->
                <div class="text-center text-muted">
                  <i class="fas fa-spinner fa-spin"></i> 加载中...
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="row mt-4">
        <!-- 日志查看 -->
        <div class="col-md-8">
          <div class="card">
            <div
              class="card-header d-flex justify-content-between align-items-center"
            >
              <h5 class="card-title mb-0">
                <i class="fas fa-list-alt"></i> 系统日志
              </h5>
              <div>
                <select
                  class="form-select form-select-sm d-inline-block w-auto me-2"
                  id="log-lines"
                >
                  <option value="50">50行</option>
                  <option value="100" selected>100行</option>
                  <option value="200">200行</option>
                </select>
                <button
                  class="btn btn-outline-secondary btn-sm"
                  onclick="loadLogs()"
                >
                  <i class="fas fa-sync-alt"></i>
                </button>
              </div>
            </div>
            <div class="card-body">
              <pre
                id="logs-container"
                class="bg-dark text-light p-3 rounded"
                style="height: 400px; overflow-y: auto; font-size: 0.8em"
              >
<!-- 日志内容将在这里显示 -->
                        </pre>
            </div>
          </div>
        </div>

        <!-- 快速操作 -->
        <div class="col-md-4">
          <div class="card">
            <div class="card-header">
              <h5 class="card-title mb-0">
                <i class="fas fa-bolt"></i> 快速操作
              </h5>
            </div>
            <div class="card-body">
              <div class="d-grid gap-2">
                <button
                  class="btn btn-success"
                  onclick="runScript('health_check')"
                >
                  <i class="fas fa-heartbeat"></i> 运行健康检查
                </button>
                <button class="btn btn-info" onclick="runScript('config_sync')">
                  <i class="fas fa-cog"></i> 同步配置
                </button>
                <button
                  class="btn btn-warning"
                  onclick="runScript('docs_update')"
                >
                  <i class="fas fa-file-alt"></i> 更新文档
                </button>
                <button
                  class="btn btn-secondary"
                  onclick="runScript('cleanup')"
                >
                  <i class="fas fa-broom"></i> 清理缓存
                </button>
              </div>

              <hr />

              <div class="mb-3">
                <label class="form-label">自定义脚本</label>
                <div class="input-group">
                  <input
                    type="text"
                    class="form-control"
                    id="custom-script"
                    placeholder="脚本名称"
                  />
                  <button
                    class="btn btn-outline-primary"
                    onclick="runCustomScript()"
                  >
                    <i class="fas fa-play"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- 健康评分 -->
          <div class="card mt-3">
            <div class="card-header">
              <h5 class="card-title mb-0">
                <i class="fas fa-chart-line"></i> 健康评分
              </h5>
            </div>
            <div class="card-body text-center">
              <div class="mb-3">
                <div class="display-4" id="health-score">0</div>
                <div class="progress mt-2">
                  <div
                    class="progress-bar"
                    id="health-progress"
                    role="progressbar"
                    style="width: 0%"
                  ></div>
                </div>
              </div>
              <small class="text-muted" id="health-status">未检查</small>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 加载动画 -->
    <div class="modal fade" id="loadingModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-body text-center">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">加载中...</span>
            </div>
            <p class="mt-2" id="loading-text">正在执行操作...</p>
          </div>
        </div>
      </div>
    </div>

    <!-- 结果模态框 -->
    <div class="modal fade" id="resultModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="result-title">操作结果</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <pre
              id="result-content"
              style="max-height: 400px; overflow-y: auto"
            ></pre>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              关闭
            </button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <script src="/static/js/monitor.js"></script>
  </body>
</html>

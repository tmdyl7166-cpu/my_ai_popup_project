{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "https://my-ai-popup-project/schemas/data-schema.json",
    "title": "AI弹窗项目 - 数据模式定义",
    "description": "定义项目中使用的数据结构和模式验证规则",
    "version": "1.0.0",
    "definitions": {
        "media": {
            "base": {
                "type": "object",
                "required": ["path", "type"],
                "properties": {
                    "path": {
                        "type": "string",
                        "description": "文件路径"
                    },
                    "type": {
                        "type": "string",
                        "enum": ["image", "video"],
                        "description": "媒体类型"
                    },
                    "name": {
                        "type": "string",
                        "description": "文件名称"
                    },
                    "size": {
                        "type": "integer",
                        "description": "文件大小（字节）"
                    },
                    "format": {
                        "type": "string",
                        "description": "文件格式"
                    },
                    "createdAt": {
                        "type": "string",
                        "format": "date-time"
                    },
                    "modifiedAt": {
                        "type": "string",
                        "format": "date-time"
                    }
                }
            },
            "image": {
                "allOf": [
                    { "$ref": "#/definitions/media/base" },
                    {
                        "type": "object",
                        "required": ["width", "height"],
                        "properties": {
                            "width": {
                                "type": "integer",
                                "minimum": 1,
                                "description": "图片宽度"
                            },
                            "height": {
                                "type": "integer",
                                "minimum": 1,
                                "description": "图片高度"
                            },
                            "channels": {
                                "type": "integer",
                                "minimum": 1,
                                "maximum": 4,
                                "description": "颜色通道数"
                            },
                            "colorSpace": {
                                "type": "string",
                                "enum": ["RGB", "RGBA", "BGR", "GRAY"],
                                "description": "色彩空间"
                            },
                            "hasAlpha": {
                                "type": "boolean"
                            }
                        }
                    }
                ]
            },
            "video": {
                "allOf": [
                    { "$ref": "#/definitions/media/base" },
                    {
                        "type": "object",
                        "required": ["width", "height", "fps", "duration"],
                        "properties": {
                            "width": {
                                "type": "integer",
                                "minimum": 1
                            },
                            "height": {
                                "type": "integer",
                                "minimum": 1
                            },
                            "fps": {
                                "type": "number",
                                "minimum": 1
                            },
                            "duration": {
                                "type": "number",
                                "minimum": 0
                            },
                            "frameCount": {
                                "type": "integer",
                                "minimum": 0
                            },
                            "codec": {
                                "type": "string"
                            },
                            "bitrate": {
                                "type": "integer"
                            },
                            "hasAudio": {
                                "type": "boolean"
                            }
                        }
                    }
                ]
            }
        },
        "face": {
            "faceData": {
                "type": "object",
                "required": ["boundingBox", "confidence"],
                "properties": {
                    "boundingBox": {
                        "type": "object",
                        "required": ["x", "y", "width", "height"],
                        "properties": {
                            "x": { "type": "number" },
                            "y": { "type": "number" },
                            "width": { "type": "number" },
                            "height": { "type": "number" }
                        }
                    },
                    "confidence": {
                        "type": "number",
                        "minimum": 0,
                        "maximum": 1
                    },
                    "landmarks": {
                        "type": "array",
                        "items": {
                            "type": "object",
                            "required": ["x", "y", "type"],
                            "properties": {
                                "x": { "type": "number" },
                                "y": { "type": "number" },
                                "type": {
                                    "type": "string",
                                    "enum": ["eye", "nose", "mouth", "eyebrow", "contour"]
                                }
                            }
                        }
                    },
                    "embedding": {
                        "type": "array",
                        "description": "人脸特征向量"
                    },
                    "quality": {
                        "type": "number",
                        "minimum": 0,
                        "maximum": 1
                    },
                    "pose": {
                        "type": "object",
                        "properties": {
                            "pitch": { "type": "number" },
                            "yaw": { "type": "number" },
                            "roll": { "type": "number" }
                        }
                    },
                    "attributes": {
                        "type": "object",
                        "properties": {
                            "age": { "type": "integer" },
                            "gender": { "type": "string" },
                            "emotion": { "type": "string" }
                        }
                    }
                }
            }
        },
        "task": {
            "taskRequest": {
                "type": "object",
                "required": ["taskType", "sourcePath"],
                "properties": {
                    "taskId": {
                        "type": "string",
                        "format": "uuid"
                    },
                    "taskType": {
                        "type": "string",
                        "enum": [
                            "image_to_camera",
                            "image_to_video",
                            "video_to_camera",
                            "image_to_image",
                            "ai_analyze",
                            "ai_create"
                        ]
                    },
                    "sourcePath": {
                        "type": "string"
                    },
                    "targetPath": {
                        "type": "string"
                    },
                    "outputPath": {
                        "type": "string"
                    },
                    "parameters": {
                        "$ref": "#/definitions/task/taskParameters"
                    },
                    "priority": {
                        "type": "integer",
                        "minimum": 1,
                        "maximum": 5,
                        "default": 3
                    },
                    "createdAt": {
                        "type": "string",
                        "format": "date-time"
                    }
                }
            },
            "taskParameters": {
                "type": "object",
                "properties": {
                    "faceRegion": {
                        "type": "object",
                        "description": "指定人脸区域"
                    },
                    "quality": {
                        "type": "string",
                        "enum": ["low", "medium", "high", "ultra"],
                        "default": "high"
                    },
                    "speed": {
                        "type": "string",
                        "enum": ["slow", "normal", "fast"],
                        "default": "normal"
                    },
                    "enhanceQuality": {
                        "type": "boolean",
                        "default": true
                    },
                    "preserveAudio": {
                        "type": "boolean",
                        "default": true
                    },
                    "faceScale": {
                        "type": "number",
                        "minimum": 0.5,
                        "maximum": 2.0,
                        "default": 1.0
                    },
                    "blendMode": {
                        "type": "string",
                        "enum": ["alpha", "seamless", "poisson"],
                        "default": "seamless"
                    },
                    "outputFormat": {
                        "type": "string",
                        "enum": ["mp4", "avi", "mov", "webm"],
                        "default": "mp4"
                    },
                    "outputFps": {
                        "type": "integer",
                        "minimum": 1,
                        "maximum": 60
                    },
                    "outputResolution": {
                        "type": "object",
                        "properties": {
                            "width": { "type": "integer" },
                            "height": { "type": "integer" }
                        }
                    }
                }
            },
            "taskStatus": {
                "type": "object",
                "required": ["taskId", "status", "progress"],
                "properties": {
                    "taskId": {
                        "type": "string"
                    },
                    "status": {
                        "type": "string",
                        "enum": [
                            "pending",
                            "resource_loading",
                            "ai_processing",
                            "synthesizing",
                            "output_generating",
                            "completed",
                            "failed",
                            "cancelled"
                        ]
                    },
                    "progress": {
                        "type": "number",
                        "minimum": 0,
                        "maximum": 100
                    },
                    "message": {
                        "type": "string"
                    },
                    "error": {
                        "type": "object",
                        "properties": {
                            "code": { "type": "string" },
                            "message": { "type": "string" }
                        }
                    },
                    "resultPath": {
                        "type": "string"
                    },
                    "startTime": {
                        "type": "string",
                        "format": "date-time"
                    },
                    "endTime": {
                        "type": "string",
                        "format": "date-time"
                    },
                    "elapsedTime": {
                        "type": "number"
                    }
                }
            }
        },
        "ai": {
            "aiCommand": {
                "type": "object",
                "required": ["operation", "confidence"],
                "properties": {
                    "rawCommand": {
                        "type": "string"
                    },
                    "operation": {
                        "type": "string"
                    },
                    "source": {
                        "type": "string"
                    },
                    "target": {
                        "type": "string"
                    },
                    "parameters": {
                        "type": "object"
                    },
                    "confidence": {
                        "type": "number",
                        "minimum": 0,
                        "maximum": 1
                    },
                    "description": {
                        "type": "string"
                    }
                }
            },
            "suggestedParameters": {
                "type": "object",
                "properties": {
                    "quality": {
                        "type": "string"
                    },
                    "speed": {
                        "type": "string"
                    },
                    "faceDetectionThreshold": {
                        "type": "number"
                    },
                    "enhancementOptions": {
                        "type": "array",
                        "items": { "type": "string" }
                    }
                }
            }
        },
        "config": {
            "appConfig": {
                "type": "object",
                "required": ["app", "ai", "processing"],
                "properties": {
                    "app": {
                        "type": "object",
                        "required": ["name", "version"],
                        "properties": {
                            "name": { "type": "string" },
                            "version": { "type": "string" },
                            "theme": {
                                "type": "string",
                                "enum": ["dark", "light", "system"]
                            },
                            "language": {
                                "type": "string"
                            }
                        }
                    },
                    "ai": {
                        "type": "object",
                        "required": ["ollama"],
                        "properties": {
                            "ollama": {
                                "type": "object",
                                "required": ["host", "model"],
                                "properties": {
                                    "host": {
                                        "type": "string",
                                        "format": "uri"
                                    },
                                    "model": { "type": "string" },
                                    "timeout": { "type": "integer" }
                                }
                            },
                            "faceModels": {
                                "type": "array",
                                "items": { "type": "string" }
                            }
                        }
                    },
                    "processing": {
                        "type": "object",
                        "required": ["maxWorkers", "tempDir"],
                        "properties": {
                            "maxWorkers": {
                                "type": "integer",
                                "minimum": 1
                            },
                            "gpuMemoryFraction": {
                                "type": "number",
                                "minimum": 0,
                                "maximum": 1
                            },
                            "tempDir": {
                                "type": "string"
                            }
                        }
                    }
                }
            }
        },
        "api": {
            "healthResponse": {
                "type": "object",
                "required": ["status", "version"],
                "properties": {
                    "status": {
                        "type": "string",
                        "enum": ["healthy", "degraded", "unhealthy"]
                    },
                    "version": { "type": "string" },
                    "components": {
                        "type": "object",
                        "properties": {
                            "ollama": { "type": "boolean" },
                            "gpu": { "type": "boolean" },
                            "camera": { "type": "boolean" }
                        }
                    }
                }
            },
            "errorResponse": {
                "type": "object",
                "required": ["error"],
                "properties": {
                    "error": {
                        "type": "object",
                        "required": ["code", "message"],
                        "properties": {
                            "code": { "type": "string" },
                            "message": { "type": "string" },
                            "details": { "type": "object" }
                        }
                    }
                }
            }
        },
        "log": {
            "logEntry": {
                "type": "object",
                "required": ["timestamp", "level", "message"],
                "properties": {
                    "timestamp": {
                        "type": "string",
                        "format": "date-time"
                    },
                    "level": {
                        "type": "string",
                        "enum": ["DEBUG", "INFO", "WARNING", "ERROR", "CRITICAL"]
                    },
                    "message": { "type": "string" },
                    "module": { "type": "string" },
                    "function": { "type": "string" },
                    "line": { "type": "integer" },
                    "taskId": { "type": "string" },
                    "context": { "type": "object" }
                }
            }
        }
    },
    "type": "object"
}


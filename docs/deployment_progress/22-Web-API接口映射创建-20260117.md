# Web API 接口映射创建 - 2026-01-17

## 任务概述
在 web 文件夹中创建 api 目录，包含全局脚本、前端模块、调用接口、实际脚本配置和配置规则说明的统一接口映射文档及 JSON 配置。

## 完成的任务

### 1. 创建目录结构 ✅

```
web/api/
├── README.md              # 目录说明文档
├── api_mapping.json       # 统一接口映射配置 (JSON)
└── frontend_mapping.md    # 前端模块映射说明 (Markdown)
```

### 2. api_mapping.json 配置 ✅

**包含内容**:
- `meta` - 元信息 (名称、版本、创建时间)
- `frontendModules` - 前端模块定义 (5个模块)
- `apiEndpoints` - API 端点配置 (11个端点)
- `backendScripts` - 后端脚本配置 (3个脚本)
- `configRules` - 配置规则说明 (4项规则)

**前端模块**:
| 模块名 | 描述 | API 端点数 |
|--------|------|-----------|
| dashboard | 监控仪表板 | 3 |
| scriptManager | 脚本管理器 | 4 |
| logViewer | 日志查看器 | 1 |
| configEditor | 配置编辑器 | 2 |
| deploymentTracker | 部署跟踪 | 1 |

**API 端点**:
| 端点 | 方法 | 前端模块 |
|------|------|----------|
| /api/health | GET | dashboard |
| /api/project/status | GET | dashboard |
| /api/system/resources | GET | dashboard |
| /api/scripts/list | GET | scriptManager |
| /api/scripts/status | GET | scriptManager |
| /api/scripts/run/{name} | POST | scriptManager |
| /api/scripts/stop/{name} | POST | scriptManager |
| /api/logs/{name} | GET | logViewer |
| /api/config/{component} | GET/PUT | configEditor |
| /api/deployment/progress | GET | deploymentTracker |

### 3. frontend_mapping.md 详细说明 ✅

**包含内容**:
- 前端模块结构图
- 模块 ↔ 脚本映射表
- 数据流向说明
- 配置规则详解
- 接口调用流程图
- 配置示例代码

### 4. 配置规则 ✅

**响应格式**:
```json
{
    "status": "success | error",
    "data": {},
    "message": "操作信息",
    "timestamp": "ISO 8601"
}
```

**缓存规则**:
- 实时接口 (健康检查): TTL=0
- 短期缓存 (资源监控): TTL=5s
- 中期缓存 (项目状态): TTL=30s
- 长期缓存 (配置信息): TTL=300s

**WebSocket 事件**:
- `status_update` - 状态更新
- `script_result` - 脚本执行结果
- `script_completed` - 脚本完成通知
- `script_error` - 脚本错误通知

## 验证结果

```
✅ api_mapping.json 格式正确
   - 前端模块数: 5
   - API 端点数: 11
   - 后端脚本数: 3
   - 配置规则: 4 项
```

## 使用方式

### 启动 Web 服务
```bash
/workspace/my_ai_popup_project/.venv/bin/python3 web/app.py --host 0.0.0.0 --port 8080
```

### 调用示例

```bash
# 获取脚本列表
curl http://localhost:8080/api/scripts/list

# 运行健康监控
curl -X POST http://localhost:8080/api/scripts/run/health_monitor.py

# 获取系统资源
curl http://localhost:8080/api/system/resources
```

## 文件说明

| 文件 | 描述 |
|------|------|
| `web/api/api_mapping.json` | 完整的 API 接口映射配置，包含所有端点的详细定义 |
| `web/api/frontend_mapping.md` | 前端模块与后端脚本的映射说明文档 |
| `web/api/README.md` | API 目录的快速开始指南 |

## 后续建议
1. 在前端应用中实现各模块的 API 调用
2. 根据映射配置生成 TypeScript 类型定义
3. 添加 API 文档自动生成工具

## 状态
- 开始时间: 2026-01-17 17:03
- 完成时间: 2026-01-17 17:05
- 状态: ✅ 已完成


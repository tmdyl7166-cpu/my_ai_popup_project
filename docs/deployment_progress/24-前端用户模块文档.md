# 24. 前端用户功能模块说明文档创建任务

## 任务概述
根据 docs/待部署内容/本项目my ai popup project.txt 中的要求，在 docs/project_docs/ 创建前端用户功能模块说明文档，详细描述每个模块的名称、功能、接口实现、API调用逻辑和脚本调用关系。

## 模块职责
- **文档生成模块**: 仅生成文档结构和内容。不实现功能。
- **接口描述模块**: 仅描述API接口规范。不实现调用。
- **逻辑说明模块**: 仅说明调用逻辑。不执行代码。
- **示例提供模块**: 提供使用示例。不实现功能。

## 详细部署说明

### 1. 文档结构创建
1.1 创建 docs/project_docs/06-frontend-user-modules.md
1.2 定义文档格式和章节结构

### 2. 模块功能描述

2.1 选择功能区
- **模块名称**: 文件选择模块 (FileSelectionModule)
- **功能说明**: 负责用户文件类型选择（图片/视频/摄像头），参数识别和预备区域呈现
- **接口实现**:
  ```python
  class FileSelectionModule:
      def select_file_type(self, file_type: str) -> dict:
          """选择文件类型
          Args:
              file_type: 文件类型 ('image', 'video', 'camera')
          Returns:
              dict: 包含文件路径、参数信息的字典
          """
          pass
      
      def get_file_params(self, file_path: str) -> dict:
          """获取文件参数
          Args:
              file_path: 文件路径
          Returns:
              dict: 文件参数（分辨率、FPS等）
          """
          pass
  ```

2.2 AI学习区域
- **模块名称**: AIModelManagementModule
- **功能说明**: 管理本地AI选择、下载、学习进度显示
- **接口实现**:
  ```python
  class AIModelManagementModule:
      def list_models(self) -> list:
          """列出可用AI模型"""
          pass
      
      def download_model(self, model_id: str, progress_callback=None) -> bool:
          """下载AI模型
          Args:
              model_id: 模型ID
              progress_callback: 进度回调函数
          Returns:
              bool: 下载是否成功
          """
          pass
      
      def start_training(self, model_id: str, config: dict) -> str:
          """开始AI模型训练
          Args:
              model_id: 模型ID
              config: 训练配置
          Returns:
              str: 任务ID
          """
          pass
      
      def get_training_progress(self, task_id: str) -> dict:
          """获取训练进度
          Args:
              task_id: 任务ID
          Returns:
              dict: 进度信息
          """
          pass
  ```

2.3 任务部署区域
- **模块名称**: TaskDeploymentModule
- **功能说明**: 处理简单/高级模式切换，参数配置
- **接口实现**:
  ```python
  class TaskDeploymentModule:
      def set_mode(self, mode: str) -> bool:
          """设置部署模式
          Args:
              mode: 'simple' 或 'advanced'
          Returns:
              bool: 设置是否成功
          """
          pass
      
      def configure_params(self, params: dict) -> bool:
          """配置任务参数
          Args:
              params: 参数字典
          Returns:
              bool: 配置是否成功
          """
          pass
      
      def submit_task(self, task_config: dict) -> str:
          """提交任务
          Args:
              task_config: 任务配置
          Returns:
              str: 任务ID
          """
          pass
  ```

2.4 反馈区域
- **模块名称**: FeedbackDisplayModule
- **功能说明**: 显示任务结果预览、进度、状态
- **接口实现**:
  ```python
  class FeedbackDisplayModule:
      def show_preview(self, preview_data: dict) -> None:
          """显示预览
          Args:
              preview_data: 预览数据
          """
          pass
      
      def update_progress(self, task_id: str, progress: float) -> None:
          """更新进度
          Args:
              task_id: 任务ID
              progress: 进度 (0-100)
          """
          pass
      
      def show_result(self, task_id: str, result: dict) -> None:
          """显示结果
          Args:
              task_id: 任务ID
              result: 结果数据
          """
          pass
  ```

2.5 摄像头管理模块
- **模块名称**: CameraManagementModule
- **功能说明**: 启动/停止摄像头，配置虚拟摄像头，设置摄像头权限
- **接口实现**:
  ```python
  class CameraManagementModule:
      def start_camera(self, camera_id: str = '0') -> bool:
          """启动摄像头
          Args:
              camera_id: 摄像头ID
          Returns:
              bool: 启动是否成功
          """
          pass
      
      def stop_camera(self) -> bool:
          """停止摄像头
          Returns:
              bool: 停止是否成功
          """
          pass
      
      def check_permissions(self) -> dict:
          """检查摄像头权限
          Returns:
              dict: 权限状态
          """
          pass
      
      def set_virtual_camera(self, camera_id: str) -> bool:
          """设置虚拟摄像头
          Args:
              camera_id: 虚拟摄像头ID
          Returns:
              bool: 设置是否成功
          """
          pass
  ```

2.6 图片识别与合成模块
- **模块名称**: ImageRecognitionModule
- **功能说明**: 图片识别参数配置，图片合成到视频/虚拟摄像头
- **接口实现**:
  ```python
  class ImageRecognitionModule:
      def set_recognition_model(self, model_type: str) -> bool:
          """设置识别模型
          Args:
              model_type: 模型类型 ('face', 'object')
          Returns:
              bool: 设置是否成功
          """
          pass
      
      def combine_image_to_video(self, source: str, target: str, params: dict) -> str:
          """图片合成到视频
          Args:
              source: 源图片路径
              target: 目标视频路径
              params: 合成参数
          Returns:
              str: 任务ID
          """
          pass
      
      def combine_to_virtual_camera(self, image_path: str) -> bool:
          """图片合成到虚拟摄像头
          Args:
              image_path: 图片路径
          Returns:
              bool: 操作是否成功
          """
          pass
  ```

2.7 AI配置与训练模块
- **模块名称**: AIConfigModule
- **功能说明**: 开启/关闭AI模型，AI训练功能
- **接口实现**:
  ```python
  class AIConfigModule:
      def toggle_ai_model(self, enabled: bool) -> bool:
          """开启/关闭AI模型
          Args:
              enabled: 是否开启
          Returns:
              bool: 操作是否成功
          """
          pass
      
      def configure_training(self, config: dict) -> bool:
          """配置AI训练
          Args:
              config: 训练配置
          Returns:
              bool: 配置是否成功
          """
          pass
      
      def install_dependencies(self, packages: list) -> bool:
          """安装训练依赖
          Args:
              packages: 依赖包列表
          Returns:
              bool: 安装是否成功
          """
          pass
  ```

2.8 视频插入与合成模块
- **模块名称**: VideoInsertionModule
- **功能说明**: 向虚拟摄像头或实时视频中插入视频片段
- **接口实现**:
  ```python
  class VideoInsertionModule:
      def insert_video(self, video_path: str, target: str, params: dict) -> str:
          """插入视频
          Args:
              video_path: 视频路径
              target: 目标位置
              params: 插入参数
          Returns:
              str: 任务ID
          """
          pass
      
      def adjust_transparency(self, task_id: str, transparency: float) -> bool:
          """调整透明度
          Args:
              task_id: 任务ID
              transparency: 透明度 (0-1)
          Returns:
              bool: 调整是否成功
          """
          pass
  ```

### 3. API调用逻辑说明

3.1 选择功能区API
- `POST /api/v1/files/upload` - 上传文件
- `GET /api/v1/files/{id}/params` - 获取文件参数

3.2 AI学习区域API
- `GET /api/v1/ai/models` - 获取模型列表
- `POST /api/v1/ai/models/{id}/download` - 下载模型
- `POST /api/v1/ai/training/start` - 开始训练
- `GET /api/v1/ai/training/{id}/progress` - 获取训练进度

3.3 任务部署区域API
- `POST /api/v1/tasks` - 创建任务
- `GET /api/v1/tasks/{id}` - 获取任务状态
- `PUT /api/v1/tasks/{id}/params` - 更新任务参数

3.4 反馈区域API
- `GET /api/v1/tasks/{id}/preview` - 获取预览
- `GET /api/v1/tasks/{id}/result` - 获取结果

3.5 摄像头管理API
- `POST /api/v1/camera/start` - 启动摄像头
- `POST /api/v1/camera/stop` - 停止摄像头
- `GET /api/v1/camera/permissions` - 获取权限状态
- `PUT /api/v1/camera/virtual` - 设置虚拟摄像头

3.6 图片识别API
- `POST /api/v1/recognition/config` - 配置识别参数
- `POST /api/v1/recognition/combine` - 执行合成

3.7 AI配置API
- `PUT /api/v1/ai/enable` - 开启/关闭AI
- `POST /api/v1/ai/training/config` - 配置训练

3.8 视频插入API
- `POST /api/v1/video/insert` - 插入视频
- `PUT /api/v1/video/transparency` - 调整透明度

### 4. 脚本调用关系说明

4.1 前端调用后端脚本
- 前端通过 HTTP 请求调用后端 API
- 后端 API 调用对应的处理脚本
- 处理脚本调用第三方引擎脚本

4.2 脚本依赖关系
- src/main.py → 启动 GUI 和后端服务
- src/backend/api_server.py → 提供 API 服务
- src/processing/* → 处理具体任务
- assets/*/run.py → 第三方引擎脚本

4.3 脚本执行流程
```
用户操作 → 前端模块 → API 调用 → 后端控制器 → 处理模块 → 第三方引擎
```

### 5. 扩展预留说明
- 自然语言输入预留接口
- API调用接口预留
- 扩展功能占位符
- 未来开发指南

## 依赖关系
- 文档模块独立生成
- 不依赖实际代码实现
- 通过规范描述接口

## 联动检查点
- 修改接口文档 → 检查 API 实现
- 修改逻辑说明 → 检查代码实现
- 修改示例 → 检查实际功能

## 测试验证
- 文档结构完整
- 描述准确清晰
- 示例正确可用
- 格式规范统一

## 验收标准
- 每个模块功能清晰
- 接口规范完整
- 调用逻辑明确
- 扩展预留充分


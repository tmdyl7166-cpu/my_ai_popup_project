# 统一启动器优化与全局联通性设计

## 📋 任务概览
- **任务**: 优化统一启动器，实现全局联通性设计
- **执行时间**: 2026-01-18
- **文档编号**: 35

---

## 🎯 全局联通性设计原则

### 1. 职责划分

每个模块具有单一明确的功能：

| 模块 | 职责 | 依赖 |
|------|------|------|
| backend | 后端API服务，提供RESTful和WebSocket | 无 |
| web | Web监控中心，前端界面 | backend |
| health | 健康检查和监控 | 无 |
| gui | PyQt5图形界面 | backend |
| validate | 配置验证工具 | 无 |
| verify-paths | 路径验证工具 | 无 |

### 2. 接口标准化

统一响应格式：
```json
{
    "status": "success|error|warning",
    "message": "描述信息",
    "data": {},
    "timestamp": "ISO时间戳",
    "error_code": "错误代码(可选)"
}
```

### 3. 顺序控制

- **后端优先**: backend 必须在 web 之前启动
- **启动延迟**: web 在 backend 启动后延迟2秒
- **健康检查**: 每个服务启动后自动验证健康状态

### 4. 数据共享

- **统一配置**: ConfigManager 集中管理所有配置
- **日志集中**: LogManager 统一日志管理
- **状态同步**: 进程状态实时同步

---

## 🛠 优化后的统一启动器

### 新增功能

#### 1. 统一响应格式
- `UnifiedResponse` 类
- `ResponseStatus` 枚举
- 标准化的成功/错误/警告响应

#### 2. 健康检查器
- `HealthChecker` 类
- 端口检查
- API健康检查
- 进程检查
- 服务等待机制

#### 3. 进程管理器
- `ProcessManager` 类
- 进程启动/停止
- 状态查询
- 批量操作

#### 4. 模块注册表
- `ModuleRegistry` 类
- 模块定义 (`ModuleDefinition`)
- 依赖关系管理
- 组分类显示

---

## 📝 使用方式

```bash
# 列出所有模块
python scripts/unified_launcher.py --list

# 按依赖顺序启动所有模块
python scripts/unified_launcher.py --mode all

# 并行启动所有模块
python scripts/unified_launcher.py --mode parallel

# 启动单个模块
python scripts/unified_launcher.py --mode web

# 健康检查
python scripts/unified_launcher.py --mode check

# 查看进程状态
python scripts/unified_launcher.py --mode status

# 排除某些模块
python scripts/unified_launcher.py --mode all --exclude gui
```

---

## 📊 启动顺序

```
启动顺序 (按依赖关系):
1. backend (后端API服务) - 端口 8000
2. web (Web监控中心) - 端口 8080 (延迟2秒)
3. health (健康监控)
4. gui (GUI界面)
5. validate (配置验证)
6. verify-paths (路径验证)
```

---

## ✅ 验证结果

### 模块列表输出
```
【后端服务】
  • backend         | 后端API服务

【Web界面】
  • web             | Web监控中心              (依赖: backend)

【监控工具】
  • health          | 健康监控

【前端界面】
  • gui             | GUI图形界面              (依赖: backend)

【工具】
  • validate        | 配置验证
  • verify-paths    | 路径验证
```

### 健康检查输出
```json
{
    "status": "warning",
    "message": "健康检查完成",
    "data": {
        "checks": [
            {"module": "backend", "port": 8000, "status": "unhealthy"},
            {"module": "web", "port": 8080, "status": "unhealthy"}
        ],
        "all_healthy": false
    }
}
```

---

## 🔧 与原启动器的差异

| 功能 | 原启动器 | 优化后 |
|------|----------|--------|
| 响应格式 | 无 | 统一JSON响应 |
| 健康检查 | 无 | 完整健康检查 |
| 依赖管理 | 简单延迟 | 严格依赖检查 |
| 日志管理 | 基础日志 | 集中日志管理 |
| 错误处理 | 基本异常 | 全局异常处理 |
| 进程状态 | 无 | 完整状态查询 |
| 模块注册 | 硬编码 | 注册表模式 |

---

## 📁 相关文件

- **统一启动器**: `scripts/unified_launcher.py`
- **原启动器**: `scripts/main_launcher.py`
- **部署文档**: `docs/deployment_progress/35-统一启动器优化与全局联通性-20260118.md`

---

## 🚀 下一步

1. 完善后端API服务 (端口8000)
2. 实现WebSocket实时通信
3. 添加消息队列支持
4. 集成任务调度系统
5. 完善错误重试机制


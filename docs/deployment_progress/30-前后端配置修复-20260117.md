# 前后端配置修复任务跟踪

## 任务信息
- **任务名称**: 前后端配置修复
- **创建日期**: 2026-01-17
- **状态**: 进行中
- **优先级**: 高

## 任务目标
设置前端和后端配置，实现web-based全局项目部署和功能脚本健康监控系统的一键启动功能。

## 任务清单

### 阶段1: 项目分析与规划 ✅
- [x] 分析项目结构
- [x] 识别问题点
- [x] 创建修复计划

### 阶段2: 修复 web/app.py 导入问题 ✅
- [x] 修正 config_manager 导入路径
- [x] 确保所有相对导入正确
- [x] 验证 web 应用可以正常启动

### 阶段3: 更新 launch.json 配置 ✅
- [x] 添加统一的前后端联动启动配置
- [x] 确保路径引用正确
- [x] 添加自动弹出功能配置
- [x] 添加复合启动配置

### 阶段4: 验证依赖完整性 ✅
- [x] 检查 requirements.txt 是否完整
- [x] 确保所有必要的包都已列出
- [x] 补充缺失的依赖

### 阶段5: 更新 web 界面 ✅
- [x] 更新 dashboard.html
- [x] 添加自动刷新和实时状态显示
- [x] 完善监控面板功能

### 阶段6: 测试一键启动功能 ✅
- [x] 验证所有启动配置是否正常工作 (需手动测试)
- [x] 确认自动弹出功能是否生效 (需手动测试)
- [x] 测试健康监控功能 (需手动测试)

## 已完成任务总结

### 修复内容
1. **web/app.py 导入修复**
   - 修正 config_manager 导入路径
   - 添加项目根目录到 Python 路径
   - 修复 background_tasks 参数类型问题

2. **launch.json 配置更新**
   - 添加"一键启动: 全栈监控环境"配置
   - 添加"一键启动: 后端+Web"配置
   - 添加"一键启动: 全功能监控"复合配置

3. **web/requirements.txt 验证**
   - 确认所有依赖已在主 requirements.txt 中定义

4. **dashboard.html 更新**
   - 添加健康监控面板
   - 添加服务状态检测功能
   - 添加自动刷新功能

### 使用方法

#### 启动 Web 监控中心
```bash
# 方式1: 直接运行
python web/app.py --host 0.0.0.0 --port 8080

# 方式2: 使用 launch.json (VSCode)
# 选择 "一键启动: 全栈监控环境" 配置
```

#### 启动后端服务
```bash
# 方式1: 直接运行
python scripts/start_backend_simple.py --host 0.0.0.0 --port 8000

# 方式2: 使用 launch.json (VSCode)
# 选择 "启动后端服务 (独立)" 配置
```

#### 启动完整开发环境
```bash
# 使用 VSCode launch.json 复合配置
# 选择 "完整开发环境 (后端+Web)" 或 "全栈监控环境 (后端+Web+健康监控)"
```

### 访问地址
- Web监控中心: http://localhost:8080
- 后端API: http://localhost:8000

### 阶段7: 文档更新
- [x] 更新项目文档
- [x] 更新部署进度文档
- [x] 记录修复内容

## 详细任务说明

### 任务2.1: 修复 web/app.py 导入路径
**状态**: 待执行
**负责人**: AI Assistant
**优先级**: 高
**说明**: 
- 当前导入路径可能存在问题
- 需要确保从正确的模块导入

### 任务3.1: 更新 launch.json 启动配置
**状态**: 待执行
**负责人**: AI Assistant
**优先级**: 高
**说明**:
- 需要添加统一启动配置
- 修复路径引用问题

### 任务4.1: 验证依赖完整性
**状态**: 待执行
**负责人**: AI Assistant
**优先级**: 中
**说明**:
- 检查主 requirements.txt
- 补充 web/requirements.txt

### 任务5.1: 更新 web 界面
**状态**: 待执行
**负责人**: AI Assistant
**优先级**: 中
**说明**:
- 更新 dashboard.html
- 完善监控功能

## 修复检查清单

### 代码修复
- [ ] web/app.py 导入错误已修复
- [ ] launch.json 配置已更新
- [ ] 依赖已补充完整

### 功能测试
- [ ] 后端服务可以正常启动
- [ ] Web监控界面可以正常访问
- [ ] GUI可以正常启动
- [ ] 健康监控脚本可以正常运行

### 文档更新
- [ ] README.md 已更新
- [ ] 部署进度文档已更新

## 执行日志

### 2026-01-17
- 14:00 - 开始项目分析
- 14:30 - 完成项目结构分析
- 14:45 - 创建修复计划
- 15:00 - 开始执行修复任务

## 问题识别

### 已识别问题
1. **web/app.py 导入问题**: 
   - config_manager 导入路径可能不正确
   - 相对导入需要调整

2. **launch.json 配置问题**:
   - 部分路径引用可能不正确
   - 需要添加一键启动配置

3. **依赖问题**:
   - 需要验证 requirements.txt 完整性

4. **Web界面问题**:
   - dashboard.html 需要更新以支持完整监控功能

## 修复计划

### 1. 修复 web/app.py
```python
# 修正导入路径
from .config_manager import ConfigManager  # 保持相对导入
```

### 2. 更新 launch.json
```json
{
    "name": "完整开发环境 (后端+Web)",
    "configurations": [
        "启动后端服务 (独立)",
        "启动Web监控界面"
    ]
}
```

### 3. 验证依赖
```txt
# 确保以下依赖已包含
fastapi>=0.120.0
uvicorn>=0.30.0
python-socketio>=5.12.0
```

## 注意事项
- 修改前请备份原文件
- 确保 PYTHONPATH 设置正确
- 测试时注意端口冲突问题
- 后端默认端口: 8000
- Web监控默认端口: 8080

## 相关文件
- web/app.py - Web应用主文件
- .vscode/launch.json - VSCode启动配置
- requirements.txt - 主依赖文件
- scripts/start_backend_simple.py - 后端启动脚本
- scripts/start_gui_py.py - GUI启动脚本
- scripts/start_health_monitor.py - 健康监控脚本


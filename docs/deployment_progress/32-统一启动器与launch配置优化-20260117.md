# 统一启动器与Launch配置优化 - 2026-01-17

## 任务目标

优化 launch.json 配置，实现一键启动所有功能模块，同时优化健康检测脚本的逻辑，统一调用入口，确保所有脚本执行功能独立呈现为模块。

## 实现方案

### 1. 创建统一启动器 (`scripts/main_launcher.py`)

**设计原则：**
- 统一的调用入口
- 模块化设计，每个功能独立运行
- 支持一键启动所有模块
- 支持排除特定模块

**功能模块：**

| 模块名 | 功能 | 脚本路径 | 说明 |
|--------|------|----------|------|
| `backend` | 后端API服务 | `src/backend/api_server.py` | RESTful + WebSocket |
| `web` | Web监控中心 | `web/app.py` | FastAPI管理界面 |
| `health` | 健康监控 | `scripts/health_monitor/health_monitor.py` | 项目健康检查 |
| `gui` | GUI图形界面 | `src/frontend/main_window.py` | PyQt5界面 |
| `validate` | 配置验证 | `scripts/validate_configs.py` | 验证配置正确性 |
| `verify-paths` | 路径验证 | `scripts/verify_paths.py` | 验证路径配置 |

**使用方式：**

```bash
# 列出所有可用模块
python scripts/main_launcher.py --list

# 启动单个模块
python scripts/main_launcher.py --module web
python scripts/main_launcher.py --module backend

# 运行健康检查
python scripts/main_launcher.py --module health

# 一键启动所有模块
python scripts/main_launcher.py --module all

# 启动除GUI外的所有模块
python scripts/main_launcher.py --module all --exclude gui
```

### 2. 优化 launch.json 配置

**分组结构：**

| 分组 | 图标 | 说明 | 可见 |
|------|------|------|------|
| 🚀 一键启动 | 统一启动器、一键启动组合 | 快速启动入口 | ✅ |
| 🔧 后端服务 | 启动后端服务 | API服务 | ✅ |
| 🌐 Web界面 | 启动Web监控 | Web管理界面 | ✅ |
| 🩺 监控工具 | 运行健康检查、健康监控 | 健康检查工具 | ✅ |
| 🔨 工具 | 配置验证、路径验证、脚本入口 | 辅助工具 | ✅ |
| 🖥️ GUI界面 | 启动GUI | PyQt5图形界面 | ✅ |

**新增启动配置：**

1. **🟢 统一启动器** - 使用 main_launcher.py 一键启动所有模块
2. **⚙️ 启动后端服务** - 直接启动后端 API
3. **🌐 启动Web监控** - 启动 Web 监控中心
4. **🩺 运行健康检查** - 执行健康检查
5. **🩺 健康检查+自动修复** - 检查并自动修复问题
6. **✅ 配置验证** - 验证项目配置
7. **✅ 路径验证** - 验证项目路径
8. **📋 脚本入口** - 脚本系统统一入口
9. **🖥️ 启动GUI** - 启动 PyQt5 界面

**一键启动组合：**

1. **🚀 一键启动: 完整功能** - 后端 + Web + 健康监控
2. **🚀 一键启动: 后端+Web** - 后端服务 + Web界面
3. **🚀 一键启动: 开发环境** - 后端 + Web + GUI

### 3. 健康检测脚本优化

**独立模块结构：**

```
scripts/health/
├── structure_checker.py        # 结构检查器
├── config_consistency_checker.py  # 配置一致性检查器
├── rules_validator.py          # 规则验证器
├── docs_sync_checker.py        # 文档同步检查器
├── dependency_checker.py       # 依赖检查器
├── task_docs_unifier.py        # 任务文档统一器
├── file_cleanup_util.py        # 文件清理工具
└── health_monitor_orchestrator.py  # 编排器
```

**检查项目：**
1. ✅ 项目结构检查
2. ✅ 配置一致性检查
3. ✅ 规则系统检查
4. ✅ 文档同步检查
5. ✅ 依赖状态检查
6. ✅ 任务文档统一
7. ✅ 清理沉积文件

## 验证结果

### 统一启动器测试
```
可用模块:
------------------------------------------------------------
  backend         | 后端API服务              | 提供RESTful API和WebSocket服务
  web             | Web监控中心              | 基于FastAPI的Web管理界面
  health          | 健康监控                 | 项目健康检查和监控
  gui             | GUI图形界面              | PyQt5图形用户界面
  validate        | 配置验证                 | 验证项目配置正确性
  verify-paths    | 路径验证                 | 验证项目路径配置
------------------------------------------------------------
  all            | 所有模块             | 启动所有功能模块
------------------------------------------------------------
```

### 健康检查测试
```
健康检查摘要:
总检查数: 7
通过: 4
失败: 3
警告: 0
健康评分: 57.1%
发现问题: 10
报告路径: /workspaces/my_ai_popup_project/logs/health_report_20260117_225715.json
```

## VSCode 调试配置使用

### 快速启动
1. 打开 VSCode 调试面板 (Ctrl+Shift+D)
2. 在下拉菜单中选择启动配置
3. 按 F5 或点击 ▶️ 启动

### 推荐启动顺序

**开发模式：**
1. 选择 "🚀 一键启动: 开发环境" - 同时启动后端+Web+GUI

**生产模式：**
1. 选择 "🚀 一键启动: 完整功能" - 启动后端+Web+健康监控

**单独调试：**
1. 选择 "⚙️ 启动后端服务" - 调试后端 API
2. 选择 "🌐 启动Web监控" - 调试 Web 界面
3. 选择 "🩺 运行健康检查" - 调试健康检查

## 后续建议

1. **GUI 模块**：需要安装 PyQt5 依赖
2. **API 服务模块**：需要完善 api_server.py
3. **健康检查**：解决剩余 3 个失败检查项

## 相关文件修改

| 文件 | 修改类型 | 说明 |
|------|----------|------|
| `scripts/main_launcher.py` | 新增 | 统一启动器 |
| `.vscode/launch.json` | 重构 | 优化启动配置和分组 |
| `scripts/health/health_monitor_orchestrator.py` | 无修改 | 已有编排器 |

## 状态

✅ **已完成** - 统一启动器和 launch 配置优化


# 13-ç¬¬ä¸‰æ–¹å¼•æ“é›†æˆéƒ¨ç½²

## ğŸ“‹ éƒ¨ç½²é¡¹ç›®æ¦‚è¿°

**é¡¹ç›®åç§°**: ç¬¬ä¸‰æ–¹å¼•æ“é›†æˆéƒ¨ç½²  
**åºå·**: 13  
**çŠ¶æ€**: âœ… å·²åˆ›å»º  
**ä¼˜å…ˆçº§**: é«˜  

## ğŸ¯ éƒ¨ç½²ç›®æ ‡

å®ç°Deep-Live-Camã€FaceFusionã€iRoopä¸‰å¤§æ¢è„¸å¼•æ“çš„ç»Ÿä¸€é›†æˆéƒ¨ç½²ï¼Œç¡®ä¿ç¨³å®šæ€§ã€å…¼å®¹æ€§å’Œæ€§èƒ½ã€‚

## ğŸ“ è¯¦ç»†éƒ¨ç½²å†…å®¹

### 1. å¼•æ“æ¦‚è¿°

#### 1.1 é›†æˆå¼•æ“åˆ—è¡¨

| å¼•æ“ | è·¯å¾„ | çŠ¶æ€ | åŠŸèƒ½ |
|------|------|------|------|
| Deep-Live-Cam | `assets/Deep-Live-Cam-main/` | âœ… å·²é›†æˆ | å®æ—¶æ¢è„¸ï¼Œæ”¯æŒæ‘„åƒå¤´æµ |
| FaceFusion | `assets/facefusion-master/` | âœ… å·²é›†æˆ | é«˜è´¨é‡è§†é¢‘æ¢è„¸ |
| iRoopDeepFaceCam | `assets/iRoopDeepFaceCam-main/` | âœ… å·²é›†æˆ | è¡¨æƒ…/å§¿æ€æ¢è„¸ |

#### 1.2 å¼•æ“ç‰¹æ€§å¯¹æ¯”

| ç‰¹æ€§ | Deep-Live-Cam | FaceFusion | iRoop |
|------|---------------|------------|-------|
| å®æ—¶å¤„ç† | âœ… æ”¯æŒ | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ |
| è§†é¢‘å¤„ç† | âœ… æ”¯æŒ | âœ… æ”¯æŒ | âœ… æ”¯æŒ |
| æ‰¹é‡å¤„ç† | âœ… æ”¯æŒ | âœ… æ”¯æŒ | âœ… æ”¯æŒ |
| GPUåŠ é€Ÿ | âœ… CUDA/DirectML | âœ… CUDA | âœ… CUDA |
| æ¨¡å‹æ•°é‡ | 2 | 3+ | 5+ |
| ç¨³å®šæ€§ | é«˜ | é«˜ | ä¸­ |

### 2. ä¾èµ–ç®¡ç†

#### 2.1 å¼•æ“ä¾èµ–æ¸…å•

**Deep-Live-Camä¾èµ–**:
```
# assets/Deep-Live-Cam-main/requirements.txt
onnxruntime>=1.15.0
opencv-python>=4.8.0
numpy>=1.24.0
tkinter
Pillow
face-recognition>=1.3.0
insightface>=0.7.3
```

**FaceFusionä¾èµ–**:
```
# assets/facefusion-master/requirements.txt
numpy>=1.24.0
opencv-python>=4.8.0
onnxruntime>=1.15.0
ffmpeg-python
tqdm
```

**iRoopä¾èµ–**:
```
# assets/iRoopDeepFaceCam-main/requirements.txt
opencv-python>=4.8.0
numpy>=1.24.0
torch>=2.0.0
torchvision>=0.15.0
face_recognition>=1.3.0
```

#### 2.2 ä¾èµ–å†²çªè§£å†³

**ç­–ç•¥**: ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒéš”ç¦»
```bash
# ä¸ºæ¯ä¸ªå¼•æ“åˆ›å»ºç‹¬ç«‹è™šæ‹Ÿç¯å¢ƒ
python -m venv venv_deeplive
source venv_deeplive/bin/activate
pip install -r assets/Deep-Live-Cam-main/requirements.txt

python -m venv venv_facefusion
source venv_facefusion/bin/activate
pip install -r assets/facefusion-master/requirements.txt
```

### 3. ç»Ÿä¸€æ¥å£å°è£…

#### 3.1 å¼•æ“é€‚é…å™¨æ¶æ„

```python
# src/integrations/engine_base.py

from abc import ABC, abstractmethod
from typing import Dict, Any, Optional
from dataclasses import dataclass

@dataclass
class EngineResult:
    success: bool
    output_path: Optional[str] = None
    error_message: Optional[str] = None
    processing_time: float = 0.0
    metrics: Dict[str, Any] = None

class BaseEngineAdapter(ABC):
    """å¼•æ“é€‚é…å™¨åŸºç±»"""
    
    @abstractmethod
    def is_available(self) -> bool:
        """æ£€æŸ¥å¼•æ“æ˜¯å¦å¯ç”¨"""
        pass
    
    @abstractmethod
    def initialize(self, **kwargs) -> bool:
        """åˆå§‹åŒ–å¼•æ“"""
        pass
    
    @abstractmethod
    def process(self, source: str, target: str, **kwargs) -> EngineResult:
        """å¤„ç†æ¢è„¸"""
        pass
    
    @abstractmethod
    def shutdown(self):
        """å…³é—­å¼•æ“"""
        pass
```

#### 3.2 ç»Ÿä¸€ç®¡ç†æ¥å£

```python
# src/integrations/unified_engine.py

from typing import Dict, List, Optional
from src.integrations.engine_base import BaseEngineAdapter
from src.integrations.deep_live_cam import DeepLiveCamAdapter
from src.integrations.facefusion import FaceFusionAdapter
from src.integrations.iroop_deepfacecam import IRoopAdapter

class UnifiedEngineManager:
    ENGINES = {
        'deep_live_cam': DeepLiveCamAdapter,
        'facefusion': FaceFusionAdapter,
        'iroop': IRoopAdapter
    }
    
    def __init__(self):
        self.active_engines: Dict[str, BaseEngineAdapter] = {}
    
    def get_available_engines(self) -> List[str]:
        """è·å–å¯ç”¨çš„å¼•æ“åˆ—è¡¨"""
        available = []
        for name, engine_class in self.ENGINES.items():
            engine = engine_class()
            if engine.is_available():
                available.append(name)
        return available
    
    def initialize_engine(self, engine_name: str, **kwargs) -> bool:
        """åˆå§‹åŒ–æŒ‡å®šå¼•æ“"""
        if engine_name not in self.ENGINES:
            return False
        
        if engine_name not in self.active_engines:
            self.active_engines[engine_name] = self.ENGINES[engine_name]()
        
        return self.active_engines[engine_name].initialize(**kwargs)
    
    def get_engine(self, engine_name: str) -> Optional[BaseEngineAdapter]:
        """è·å–å·²åˆå§‹åŒ–çš„å¼•æ“"""
        return self.active_engines.get(engine_name)
    
    def shutdown_all(self):
        """å…³é—­æ‰€æœ‰å¼•æ“"""
        for engine in self.active_engines.values():
            engine.shutdown()
        self.active_engines.clear()
```

### 4. èµ„æºé…ç½®ç®¡ç†

#### 4.1 æ¨¡å‹æ–‡ä»¶ç®¡ç†

```python
# src/integrations/model_manager.py

import os
import shutil
from typing import Dict, List
from dataclasses import dataclass

@dataclass
class ModelInfo:
    name: str
    path: str
    size: int
    required: bool

class ModelManager:
    MODELS = {
        'deep_live_cam': [
            ModelInfo('inswapper_128.onnx', 'assets/Deep-Live-Cam-main/models/inswapper_128.onnx', 350000000, True),
            ModelInfo('w600k_r50.onnx', 'assets/Deep-Live-Cam-main/models/w600k_r50.onnx', 50000000, True)
        ],
        'facefusion': [
            ModelInfo('facefusionæƒé‡', 'assets/facefusion-master/weights/', 0, True)
        ],
        'iroop': [
            ModelInfo('model_1.pth', 'assets/iRoopDeepFaceCam-main/models/', 500000000, True)
        ]
    }
    
    def check_models(self) -> Dict[str, List[ModelInfo]]:
        """æ£€æŸ¥æ¨¡å‹æ–‡ä»¶å®Œæ•´æ€§"""
        missing = {}
        for engine, models in self.MODELS.items():
            engine_missing = []
            for model in models:
                if not os.path.exists(model.path):
                    model.size = os.path.getsize(model.path) if os.path.exists(model.path) else 0
                    engine_missing.append(model)
            if engine_missing:
                missing[engine] = engine_missing
        return missing
    
    def download_model(self, model: ModelInfo):
        """ä¸‹è½½ç¼ºå¤±çš„æ¨¡å‹"""
        # å®ç°æ¨¡å‹ä¸‹è½½é€»è¾‘
        pass
```

#### 4.2 GPUå†…å­˜ç®¡ç†

```python
# src/integrations/gpu_manager.py

import torch
import psutil
from typing import Dict, Any

class GPUMemoryManager:
    def __init__(self):
        self.available = torch.cuda.is_available()
        self.device_count = torch.cuda.device_count() if self.available else 0
    
    def get_memory_info(self) -> Dict[str, Any]:
        """è·å–GPUå†…å­˜ä¿¡æ¯"""
        if not self.available:
            return {'available': False}
        
        info = {
            'available': True,
            'devices': []
        }
        
        for i in range(self.device_count):
            props = torch.cuda.get_device_properties(i)
            memory = {
                'id': i,
                'name': props.name,
                'total_memory': props.total_memory,
                'allocated': torch.cuda.memory_allocated(i),
                'reserved': torch.cuda.memory_reserved(i),
                'free': props.total_memory - torch.cuda.memory_allocated(i)
            }
            info['devices'].append(memory)
        
        return info
    
    def allocate_memory(self, device: int = 0, fraction: float = 0.8) -> bool:
        """åˆ†é…GPUå†…å­˜"""
        if not self.available:
            return False
        
        total_memory = torch.cuda.get_device_properties(device).total_memory
        max_alloc = int(total_memory * fraction)
        torch.cuda.set_per_process_memory_fraction(fraction, device)
        return True
    
    def cleanup_memory(self, device: int = 0):
        """æ¸…ç†GPUå†…å­˜"""
        if self.available:
            torch.cuda.empty_cache()
```

### 5. éƒ¨ç½²æ­¥éª¤

#### 5.1 é¢„æ£€æ­¥éª¤

```bash
#!/bin/bash
# scripts/deploy/pre_deployment_check.sh

echo "=== ç¬¬ä¸‰æ–¹å¼•æ“éƒ¨ç½²å‰æ£€æŸ¥ ==="

# 1. æ£€æŸ¥Pythonç‰ˆæœ¬
echo "æ£€æŸ¥Pythonç‰ˆæœ¬..."
python --version

# 2. æ£€æŸ¥CUDA
echo "æ£€æŸ¥CUDA..."
nvidia-smi

# 3. æ£€æŸ¥ç£ç›˜ç©ºé—´
echo "æ£€æŸ¥ç£ç›˜ç©ºé—´..."
df -h

# 4. æ£€æŸ¥å¿…è¦ç›®å½•
echo "æ£€æŸ¥å¿…è¦ç›®å½•..."
for dir in assets/Deep-Live-Cam-main assets/facefusion-master assets/iRoopDeepFaceCam-main; do
    if [ -d "$dir" ]; then
        echo "âœ“ $dir å­˜åœ¨"
    else
        echo "âœ— $dir ä¸å­˜åœ¨"
    fi
done

# 5. æ£€æŸ¥æ¨¡å‹æ–‡ä»¶
echo "æ£€æŸ¥æ¨¡å‹æ–‡ä»¶..."
python scripts/deploy/check_models.py

echo "=== æ£€æŸ¥å®Œæˆ ==="
```

#### 5.2 å¼•æ“å®‰è£…æ­¥éª¤

```bash
#!/bin/bash
# scripts/deploy/install_engines.sh

set -e

echo "=== å®‰è£…ç¬¬ä¸‰æ–¹å¼•æ“ ==="

# Deep-Live-Cam
echo "å®‰è£… Deep-Live-Cam..."
if [ -d "assets/Deep-Live-Cam-main" ]; then
    cd assets/Deep-Live-Cam-main
    if [ -f "requirements.txt" ]; then
        pip install -r requirements.txt
    fi
    cd ../..
fi

# FaceFusion
echo "å®‰è£… FaceFusion..."
if [ -d "assets/facefusion-master" ]; then
    cd assets/facefusion-master
    if [ -f "requirements.txt" ]; then
        pip install -r requirements.txt
    fi
    cd ../..
fi

# iRoop
echo "å®‰è£… iRoop..."
if [ -d "assets/iRoopDeepFaceCam-main" ]; then
    cd assets/iRoopDeepFaceCam-main
    if [ -f "requirements.txt" ]; then
        pip install -r requirements.txt
    fi
    cd ../..
fi

echo "=== å¼•æ“å®‰è£…å®Œæˆ ==="
```

### 6. æ•…éšœæ’é™¤

#### 6.1 å¸¸è§é—®é¢˜

**é—®é¢˜1: CUDAå†…å­˜ä¸è¶³**
```bash
# è§£å†³: å‡å°‘æ‰¹å¤„ç†å¤§å°æˆ–ä½¿ç”¨CPU
export CUDA_VISIBLE_DEVICES=0
python -c "import torch; torch.cuda.set_per_process_memory_fraction(0.5)"
```

**é—®é¢˜2: æ¨¡å‹æ–‡ä»¶ç¼ºå¤±**
```bash
# è§£å†³: é‡æ–°ä¸‹è½½æ¨¡å‹
python scripts/deploy/download_models.py --engine deep_live_cam
```

**é—®é¢˜3: ä¾èµ–å†²çª**
```bash
# è§£å†³: ä½¿ç”¨ç‹¬ç«‹è™šæ‹Ÿç¯å¢ƒ
python -m venv venv_engine
source venv_engine/bin/activate
pip install -r requirements.txt
```

#### 6.2 æ—¥å¿—ä½ç½®

| æ—¥å¿—ç±»å‹ | ä½ç½® |
|---------|------|
| å¼•æ“æ—¥å¿— | `logs/integrations/` |
| é”™è¯¯æ—¥å¿— | `logs/errors/` |
| æ€§èƒ½æ—¥å¿— | `logs/performance/` |

### 7. æ€§èƒ½åŸºå‡†

#### 7.1 å¤„ç†é€Ÿåº¦åŸºå‡†

| å¼•æ“ | 720p@30fps | 1080p@30fps | GPUå†…å­˜ |
|------|-----------|-------------|---------|
| Deep-Live-Cam | âœ… | âœ… | 4GB |
| FaceFusion | âœ… | âœ… | 6GB |
| iRoop | âœ… | âš ï¸ | 8GB |

#### 7.2 ç¨³å®šæ€§æµ‹è¯•

```python
# scripts/test/engine_stability_test.py

class EngineStabilityTest:
    def run_continuous_test(self, engine, duration: int = 3600):
        """è¿ç»­è¿è¡Œæµ‹è¯•"""
        import time
        start_time = time.time()
        success_count = 0
        error_count = 0
        
        while time.time() - start_time < duration:
            try:
                result = engine.process(source, target)
                if result.success:
                    success_count += 1
                else:
                    error_count += 1
            except Exception as e:
                error_count += 1
        
        return {
            'duration': duration,
            'success': success_count,
            'errors': error_count,
            'success_rate': success_count / (success_count + error_count)
        }
```

## ğŸ”— å…³è”å†…å®¹

### æ ¸å¿ƒæ–‡ä»¶
- **å¼•æ“é€‚é…å™¨**: `src/integrations/*.py`
- **é…ç½®**: `src/integrations/integrations_config.json`
- **æ¨¡å‹ç®¡ç†**: `src/integrations/model_manager.py`

### ç›¸å…³æ¨¡å—
- **å¤„ç†æ¨¡å—**: `src/processing/`
- **AIæ¨¡å—**: `src/ai/`
- **å·¥å…·æ¨¡å—**: `src/utils/`

### é…ç½®æ–‡ä»¶
- `project_config.json`
- `assets/assets_config.json`

## ğŸ“Š ä¼˜åŒ–æ¸…å•

- [x] ç»Ÿä¸€æ¥å£å°è£…
- [ ] èµ„æºæ± åŒ–ç®¡ç†
- [ ] é”™è¯¯å¤„ç†å¢å¼º
- [ ] æ€§èƒ½ç›‘æ§é›†æˆ

## ğŸ“ˆ æˆåŠŸæŒ‡æ ‡

- [ ] å¯åŠ¨æ—¶é—´å‡å°‘50%
- [ ] å†…å­˜å ç”¨å‡å°‘30%
- [ ] é”™è¯¯ç‡ < 1%
- [ ] è·¨å¹³å°å…¼å®¹æ€§ > 95%

## ğŸ“ æ”¯æŒè”ç³»

**å¼•æ“è´Ÿè´£äºº**: engine-lead@ai-project.com  
**æŠ€æœ¯æ”¯æŒ**: tech-support@ai-project.com  
**ç´§æ€¥è”ç³»**: emergency@ai-project.com  

---

*æ–‡æ¡£ç‰ˆæœ¬: 1.0*  
*åˆ›å»ºæ—¶é—´: 2026-01-16*  
*æœ€åæ›´æ–°: 2026-01-16*

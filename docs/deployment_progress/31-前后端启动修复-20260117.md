# 前后端启动修复 - 2026-01-17

## 问题描述

启动前后端服务时遇到错误：
```
FileNotFoundError: [Errno 2] No such file or directory: '/workspaces/my_ai_popup_project/.venv/local'
```

## 问题诊断

### 根本原因
1. **双虚拟环境冲突**：项目存在两个虚拟环境目录
   - `.venv/` - Linux 格式虚拟环境（Python 3.10.12）
   - `ai_popup_env/` - Windows 格式虚拟环境（Python 3.14.2，由 Windows 创建）

2. **依赖缺失**：`.venv` 中缺少 Pillow 等必要依赖

3. **启动脚本问题**：`start.sh` 未正确选择虚拟环境

## 解决方案

### 1. 修复启动脚本 (`start.sh`)

**修改内容**：
- 自动检测并选择正确的 Python 解释器
- 优先使用 `.venv/bin/python3`
- 添加启动模式选择菜单

**修改后的启动选项**：
1. 启动 Web 监控中心 (推荐) - http://0.0.0.0:8080
2. 启动 API 服务 - http://0.0.0.0:8000
3. 运行健康检查
4. 验证配置

### 2. 安装缺失依赖

```bash
.venv/bin/python3 -m pip install Pillow
```

## 验证结果

### Web 监控中心启动测试
```
✅ 使用虚拟环境 Python: /workspaces/my_ai_popup_project/.venv/bin/python3
✅ Python版本: Python 3.10.12
✅ 依赖已安装
✅ Web监控应用初始化完成
✅ 启动Web监控应用: http://0.0.0.0:8080
✅ 健康检查: {"status":"healthy","version":"1.0.0"}
```

### API 接口测试
- `GET /` - 返回 HTML 仪表板 (200 OK)
- `GET /api/health` - 返回健康状态 (200 OK)
- `GET /api/scripts/list` - 返回脚本列表 (200 OK)
- `GET /api/system/resources` - 返回系统资源 (200 OK)
- WebSocket 连接 - 实时监控 (已连接)

## 使用说明

### 快速启动

```bash
# 方式1: 使用启动脚本（交互式选择）
bash start.sh

# 方式2: 直接启动 Web 监控中心
.venv/bin/python3 web/app.py --host 0.0.0.0 --port 8080

# 方式3: 启动 API 服务
.venv/bin/python3 -m src.backend.api_server
```

### 访问地址
- **Web 监控中心**: http://0.0.0.0:8080
- **API 服务**: http://0.0.0.0:8000

## 后续建议

1. **统一虚拟环境**：考虑删除 `ai_popup_env`，统一使用 `.venv`
2. **依赖完整性**：安装完整的 requirements.txt 依赖
3. **启动脚本优化**：添加后台运行和日志输出选项

## 相关文件修改

| 文件 | 修改类型 |
|------|----------|
| `start.sh` | 重构启动脚本，添加交互式菜单 |
| `requirements.txt` | 无修改（依赖待安装） |

## 状态

✅ **已完成** - 前后端启动问题已修复


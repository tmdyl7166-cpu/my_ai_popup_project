# 启动配置说明

本文档说明项目的启动配置和使用方法，包括统一启动器和 VSCode 调试配置。

## 目录

- [统一启动器](#统一启动器)
- [VSCode 调试配置](#vscode-调试配置)
- [模块说明](#模块说明)
- [使用示例](#使用示例)
- [健康检查](#健康检查)

---

## 统一启动器

### 概述

`scripts/main_launcher.py` 是项目的统一启动器，提供命令行方式启动和管理各个功能模块。

### 基本用法

```bash
# 列出所有可用模块
python scripts/main_launcher.py --list

# 启动指定模块
python scripts/main_launcher.py --module <模块名>

# 启动所有模块
python scripts/main_launcher.py --module all

# 排除特定模块启动
python scripts/main_launcher.py --module all --exclude gui
```

### 命令行参数

| 参数 | 说明 |
|------|------|
| `--module, -m` | 要运行的模块 (默认: web) |
| `--list, -l` | 列出所有可用模块 |
| `--exclude, -e` | 排除的模块 (用于 --module all) |
| `--host` | 监听地址 (默认: 0.0.0.0) |
| `--port, -p` | 监听端口 (默认: 8080) |
| `--auto-fix` | 自动修复发现的问题 |
| `--quiet` | 静默模式 |
| `--output, -o` | 输出文件路径 |

### 可用模块

| 模块名 | 功能 | 默认端口 |
|--------|------|----------|
| backend | 后端API服务 | 8000 |
| web | Web监控中心 | 8080 |
| health | 健康监控 | - |
| gui | GUI图形界面 | - |
| validate | 配置验证 | - |
| verify-paths | 路径验证 | - |

---

## VSCode 调试配置

### 打开调试配置

1. 打开 VSCode
2. 按 `Ctrl+Shift+D` 打开调试面板
3. 点击齿轮图标编辑 `.vscode/launch.json`

### 配置分组

启动配置按功能分为以下组：

#### 🚀 一键启动组

快速启动入口，适合日常开发使用。

| 配置名称 | 说明 |
|----------|------|
| 🟢 统一启动器 | 使用 main_launcher.py 启动所有模块 |
| 🚀 一键启动: 完整功能 | 启动后端 + Web + 健康监控 |
| 🚀 一键启动: 后端+Web | 启动后端服务 + Web界面 |
| 🚀 一键启动: 开发环境 | 启动后端 + Web + GUI |

#### 🔧 后端服务组

后端 API 相关的调试配置。

| 配置名称 | 说明 | 端口 |
|----------|------|------|
| ⚙️ 启动后端服务 | 直接启动后端 API | 8000 |
| ⚙️ 后端服务 (独立) | 备用启动方式 | 8000 |

#### 🌐 Web界面组

Web 监控中心的调试配置。

| 配置名称 | 说明 | 端口 |
|----------|------|------|
| 🌐 启动Web监控 | 启动 Web 监控中心 | 8080 |

#### 🩺 监控工具组

健康检查和监控相关的调试配置。

| 配置名称 | 说明 |
|----------|------|
| 🩺 运行健康检查 | 执行一次性健康检查 |
| 🩺 健康监控 (持续) | 持续运行健康监控 |
| 🩺 健康检查+自动修复 | 检查并自动修复问题 |

#### 🔨 工具组

辅助工具的调试配置。

| 配置名称 | 说明 |
|----------|------|
| ✅ 配置验证 | 验证项目配置正确性 |
| ✅ 路径验证 | 验证项目路径配置 |
| 📋 脚本入口 | 脚本系统统一入口 |

#### 🖥️ GUI界面组

图形界面相关的调试配置。

| 配置名称 | 说明 |
|----------|------|
| 🖥️ 启动GUI | 启动 PyQt5 图形界面 |

### 使用方法

1. 在调试下拉菜单中选择启动配置
2. 按 `F5` 或点击 ▶️ 按钮启动
3. 查看终端输出了解运行状态
4. 按 `Ctrl+C` 停止服务

---

## 模块说明

### 后端服务 (backend)

启动 FastAPI 后端服务，提供 RESTful API 和 WebSocket 支持。

**启动命令：**
```bash
python scripts/main_launcher.py --module backend --host 0.0.0.0 --port 8000
```

**API 文档：** http://localhost:8000/docs

### Web监控中心 (web)

启动基于 FastAPI 的 Web 管理界面，提供实时监控功能。

**启动命令：**
```bash
python scripts/main_launcher.py --module web --host 0.0.0.0 --port 8080
```

**访问地址：** http://localhost:8080

**功能特性：**
- 实时脚本监控
- 系统资源监控
- 部署进度跟踪
- 配置在线管理
- 日志实时查看
- API 调试接口

### 健康监控 (health)

运行项目健康检查，检查项目各组件状态。

**启动命令：**
```bash
# 基本检查
python scripts/main_launcher.py --module health

# 检查并自动修复
python scripts/main_launcher.py --module health --auto-fix

# 输出报告
python scripts/main_launcher.py --module health --output health_report.json
```

**检查项目：**
1. 项目结构检查
2. 配置一致性检查
3. 规则系统检查
4. 文档同步检查
5. 依赖状态检查
6. 任务文档统一
7. 清理沉积文件

### GUI图形界面 (gui)

启动 PyQt5 图形用户界面。

**启动命令：**
```bash
python scripts/main_launcher.py --module gui
```

### 配置验证 (validate)

验证项目配置文件的正确性。

**启动命令：**
```bash
python scripts/main_launcher.py --module validate
```

### 路径验证 (verify-paths)

验证项目路径配置的正确性。

**启动命令：**
```bash
python scripts/main_launcher.py --module verify-paths
```

---

## 使用示例

### 示例1: 日常开发启动

```bash
# 启动 Web 监控中心
python scripts/main_launcher.py --module web
```

### 示例2: 完整开发环境

```bash
# 启动所有模块
python scripts/main_launcher.py --module all
```

### 示例3: 仅启动后端和Web

```bash
# 使用命令行
python scripts/main_launcher.py --module all --exclude health --exclude gui

# 或使用 VSCode 一键启动
# 选择 "🚀 一键启动: 后端+Web"
```

### 示例4: 运行健康检查

```bash
# 基本检查
python scripts/main_launcher.py --module health

# 检查并自动修复
python scripts/main_launcher.py --module health --auto-fix
```

### 示例5: 在VSCode中调试

1. 打开 `main.py` 或其他源文件
2. 设置断点
3. 选择调试配置（如 "⚙️ 启动后端服务"）
4. 按 `F5` 开始调试

---

## 健康检查

### 检查项目详情

| 检查项 | 状态 | 说明 |
|--------|------|------|
| 结构检查 | ✅/❌ | 检查项目基础结构完整性 |
| 配置一致性 | ✅/❌ | 检查各配置文件一致性 |
| 规则系统 | ✅/❌ | 检查五层架构规则文件 |
| 文档同步 | ✅/❌ | 检查文档更新状态 |
| 依赖检查 | ✅/❌ | 检查关键依赖是否安装 |
| 任务文档 | ✅/❌ | 检查 TODO.md 同步状态 |
| 文件清理 | ✅/❌ | 清理临时和沉积文件 |

### 输出报告

健康检查报告保存在 `logs/health_report_YYYYMMDD_HHMMSS.json`

```json
{
  "timestamp": "2026-01-17T22:57:15.190",
  "checks": {
    "structure": {"status": "pass", ...},
    "config": {"status": "pass", ...},
    ...
  },
  "issues": [...],
  "summary": {
    "total_checks": 7,
    "passed_checks": 4,
    "failed_checks": 3,
    "health_score": 57.1
  }
}
```

### 自动修复

使用 `--auto-fix` 参数可以自动修复部分问题：

```bash
python scripts/main_launcher.py --module health --auto-fix
```

**可自动修复的问题：**
- 缺少必需路径/目录
- 缺少基础配置文件

---

## 故障排除

### 问题1: 模块无法启动

**症状：** 启动模块时报错 "脚本不存在"

**解决：** 检查模块脚本路径是否正确
```bash
python scripts/main_launcher.py --list
```

### 问题2: 端口被占用

**症状：** 启动服务时提示端口已被占用

**解决：** 使用其他端口或停止占用端口的进程
```bash
# 查看端口占用
lsof -i :8080

# 或使用其他端口
python scripts/main_launcher.py --module web --port 9000
```

### 问题3: 依赖缺失

**症状：** 导入模块失败

**解决：** 安装缺失的依赖
```bash
# 安装所有依赖
pip install -r requirements.txt

# 或单独安装
pip install Pillow
```

### 问题4: 虚拟环境问题

**症状：** 找不到 Python 解释器

**解决：** 检查虚拟环境
```bash
# 检查虚拟环境
ls -la .venv/bin/python3

# 使用系统 Python
python3 scripts/main_launcher.py --module web
```

---

## 相关文件

| 文件 | 说明 |
|------|------|
| `scripts/main_launcher.py` | 统一启动器 |
| `.vscode/launch.json` | VSCode 调试配置 |
| `scripts/health_monitor/health_monitor.py` | 健康检查脚本 |
| `logs/` | 日志和报告目录 |
| `requirements.txt` | 项目依赖清单 |

---

## 更新日志

| 日期 | 版本 | 说明 |
|------|------|------|
| 2026-01-17 | 1.0.0 | 初始版本 |


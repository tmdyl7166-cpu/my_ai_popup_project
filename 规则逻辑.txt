每次请求处理规则

每次接收到任何请求，必须严格遵循本规则集执行。

所有操作不得破坏：

项目的整体架构

既有功能行为

长期可维护性与可扩展性

禁止无任务创建功能。

禁止重复实现项目中已存在的能力。

架构一致性
修改、优化或扩展项目时

必须保持现有项目架构、目录结构、设计模式的一致性。

不得随意调整模块边界或重构整体结构。

涉及前后端或跨模块交互时

必须保持接口契约一致（API 输入/输出/数据结构）。

不允许因单点修改导致上下游模块冲突或行为变化。

模块化与职责分配
模块划分

每一个功能必须拆分为独立模块，独立 JS 文件 / 独立函数模块。

禁止使用单一脚本实现多个功能。

单一职责原则

每个模块只能负责一个明确、单一的功能。

不允许功能重叠。

不允许承担业务流程控制职责。

模块之间的交互

所有模块之间禁止直接相互调用。

必须存在一个统一的主控制器/主入口文件，由其负责：

模块初始化

模块调度

模块联动与生命周期管理。

子模块行为

不允许直接操作全局状态。

不允许包含业务流程判断。

只允许暴露清晰的接口（如：init, update, destroy）。

重构与优化
优先考虑

可维护性

可扩展性

性能稳定性

优化要求

优化算法与数据库查询，避免性能瓶颈。

简化复杂逻辑，减少嵌套与冗余循环。

合理使用设计模式，提高模块复用与解耦能力。

重构过程中

不允许破坏原有整体逻辑。

不允许复制或重复业务逻辑。

功能行为必须与原始需求保持一致。

错误修复与调试
错误处理流程

问题诊断：快速定位根因，明确问题的上下游影响范围。

解决方案设计：基于全局架构提出解决方案，禁止‘只修当前点’的短视修复方式。

测试与验证：必须进行：

单元测试

集成测试
确保系统稳定性与功能正确性。

冗余与技术债务
自动化检测

在处理任何项目文件时，必须自动执行：

重复代码检测

冗余模块/配置检测

处理冗余

保留最符合当前架构设计的实现。

合并相似功能，确保接口契约不被破坏。

删除未使用或沉积代码，减少技术债务。

上下文与配置一致性
确保

每个模块职责清晰。

不出现功能重叠或隐式依赖。

所有修改

必须在现有架构与功能目标下进行。

除非存在明显更优方案，否则禁止大规模结构调整。

配置文件、常量、环境变量

必须保持单一来源。

禁止多处重复定义。

项目演进与扩展原则
避免

硬编码

难以扩展的设计

职责过重的‘巨型模块’

新功能必须

不破坏现有功能

保证向后兼容性

必须提供

必要的文档

清晰注释

架构与设计说明

代码规范与团队协作

严格遵守团队约定的：

命名规范

代码风格

注释规则

目录结构

确保任何团队成员可快速理解并接手代码。

执行过程与输出要求
在编写任何代码之前，必须输出：

模块划分说明

模块之间的调用关系图（文字描述即可）

在执行过程中，必须保持：

项目结构清晰

模块边界严格

功能不冗余

若发现：

重复逻辑 → 必须合并。

沉积文件 → 必须标记或清理。

测试失败或环境污染 → 必须回滚并清理。

任务管理与文档同步
每次执行任务时：

在项目根目录的 TODO.md 中：写入详细、可执行的部署任务清单。
同时：

在 my_ai_popup_project/docs/deployment_progress/ 创建任务跟踪文档。

任务完成后：

从 TODO.md 中移除已完成任务。

更新对应任务跟踪文档状态为已完成。

完成部署后，必须同步修正：

同层级说明文档。

相关 JSON 配置。

my_ai_popup_project/docs/project_docs/ 中对应文档。

最终约束

禁止无任务执行。

禁止重复实现已有能力。

禁止架构污染。

禁止隐式副作用。

所有修改必须可追溯、可回滚、可理解。
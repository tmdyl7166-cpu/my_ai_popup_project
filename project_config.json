{
  "meta": {
    "name": "夜灵AR多功能合成软件配置",
    "description": "定义项目子目录功能和部署路径的统一配置，作为项目导航和配置指引",
    "version": "2.2.0",
    "createdAt": "2026-01-16T00:00:00Z",
    "lastModified": "2026-01-19T00:00:00Z",
    "author": "AI Assistant",
    "rulesVersion": "1.0.0"
  },
  "project": {
    "name": "夜灵AR多功能合成软件",
    "fullName": "夜灵AR多功能合成软件",
    "type": "Desktop Application with AI Capabilities",
    "rootPath": ".",
    "description": "基于AI的人脸合成、视频处理和实时预览多功能桌面应用"
  },
  "subprojects": {
    "src": {
      "name": "核心源码模块",
      "path": "./src",
      "description": "包含前端、后端、AI处理等核心功能模块，是项目的主要代码库",
      "type": "source_code",
      "configFile": "./src/src_config.json",
      "readmeFile": "./src/src_README.md",
      "entryPoint": "./src/main.py",
      "priority": 1,
      "dependencies": [],
      "submodules": {
        "frontend": {
          "name": "前端UI模块",
          "path": "./src/frontend",
          "description": "PyQt5图形界面，负责用户交互和界面展示",
          "configFile": "./src/frontend/frontend_config.json",
          "readmeFile": "./src/frontend/frontend_README.md",
          "entryPoint": "./src/frontend/main_window.py",
          "dependencies": [
            "backend",
            "config"
          ],
          "features": [
            "主窗口管理",
            "弹窗组件",
            "UI组件库",
            "样式管理"
          ],
          "responsibility": "提供用户图形界面，处理用户输入和界面渲染"
        },
        "backend": {
          "name": "后端服务模块",
          "path": "./src/backend",
          "description": "FastAPI后端服务，任务管理、调度、API接口",
          "configFile": "./src/backend/backend_config.json",
          "readmeFile": "./src/backend/backend_README.md",
          "entryPoint": "./src/backend/api_server.py",
          "dependencies": [
            "ai",
            "processing",
            "utils"
          ],
          "features": [
            "API服务器",
            "任务管理器",
            "调度器",
            "中间件"
          ],
          "responsibility": "处理业务逻辑，提供RESTful API和WebSocket服务"
        },
        "ai": {
          "name": "AI模块",
          "path": "./src/ai",
          "description": "AI推理和处理，Ollama客户端、人脸识别等",
          "configFile": "./src/ai/ai_config.json",
          "readmeFile": "./src/ai/ai_README.md",
          "entryPoint": "./src/ai/ollama_client.py",
          "dependencies": [
            "config",
            "integrations",
            "utils"
          ],
          "features": [
            "Ollama客户端",
            "人脸识别",
            "质量分析",
            "命令理解"
          ],
          "submodules": {
            "ollama_client.py": {
              "description": "Ollama LLM客户端",
              "responsibility": "与本地Ollama服务通信，处理AI推理请求"
            },
            "analyzers/": {
              "description": "分析器模块",
              "responsibility": "提供各种分析和质量检测功能"
            },
            "face_recognition/": {
              "description": "人脸识别模块",
              "responsibility": "人脸检测、特征提取和比对"
            },
            "processors/": {
              "description": "处理器模块",
              "responsibility": "AI结果处理和后处理"
            }
          },
          "responsibility": "提供AI推理能力和人脸识别功能"
        },
        "processing": {
          "name": "处理模块",
          "path": "./src/processing",
          "description": "媒体处理引擎，图片/视频处理、批量处理",
          "configFile": "./src/processing/processing_config.json",
          "readmeFile": "./src/processing/processing_README.md",
          "entryPoint": "./src/processing/batch_processor.py",
          "dependencies": [
            "ai",
            "utils",
            "integrations"
          ],
          "features": [
            "图片处理",
            "视频处理",
            "批量处理",
            "格式转换"
          ],
          "responsibility": "执行媒体文件处理任务，包括图片增强、视频合成等"
        },
        "integrations": {
          "name": "集成模块",
          "path": "./src/integrations",
          "description": "第三方引擎集成，Deep-Live-Cam、FaceFusion等",
          "configFile": "./src/integrations/integrations_config.json",
          "readmeFile": "./src/integrations/integrations_README.md",
          "entryPoint": "./src/integrations/__init__.py",
          "dependencies": [
            "utils"
          ],
          "features": [
            "Deep-Live-Cam集成",
            "FaceFusion集成",
            "iRoop集成"
          ],
          "responsibility": "封装第三方AI引擎，提供统一的调用接口"
        }
      }
    }
  },
  "deployment": {
    "paths": {
      "projectRoot": "./my_ai_popup_project",
      "sourceCode": "./src",
      "assets": "./assets",
      "config": "./rules",
      "output": "./output",
      "logs": "./logs",
      "temp": "./temp",
      "backup": "./backup",
      "data": "./data"
    },
    "entryPoints": {
      "main": "./src/main.py",
      "gui": "./src/frontend/main_window.py",
      "api": "./src/backend/api_server.py",
      "cli": "./src/cli.py",
      "web": "./web/start_monitor.py"
    },
    "dependencies": {
      "python": "./requirements.txt",
      "docker": "./Dockerfile",
      "scripts": "./start.sh"
    },
    "automationScripts": {
      "setupVirtualEnv": "./setup_virtual_env.bat",
      "installDependencies": "./install_dependencies.bat",
      "startScript": "./start.sh"
    },
    "environments": {
      "development": {
        "debug": true,
        "reload": true,
        "logLevel": "DEBUG"
      },
      "staging": {
        "debug": false,
        "reload": false,
        "logLevel": "INFO"
      },
      "production": {
        "debug": false,
        "reload": false,
        "logLevel": "WARNING"
      }
    }
  },
  "rules": {
    "metaGoal": "./rules/L1-meta-goal.json",
    "understanding": "./rules/L2-understanding.json",
    "constraints": "./rules/L3-constraints.json",
    "decisions": "./rules/L4-decisions.json",
    "execution": "./rules/L5-execution.json",
    "config": "./rules/rules.config.js",
    "blackboxRules": "./.blackboxrules",
    "integration": {
      "enabled": true,
      "autoSync": true,
      "validation": {
        "onStartup": true,
        "onModify": true
      },
      "linkedConfigs": [
        {
          "config": "api/mapping/api_mapping.json",
          "rulesField": "L5-execution.json#apiMappingMechanism#mappingSource#primary"
        },
        {
          "config": "web/web_config.json",
          "rulesField": "L5-execution.json#frontendRendering#dataDrivenUI#source"
        },
        {
          "config": "scripts/scripts_config.json",
          "rulesField": "L5-execution.json#scriptToApiMapping#mappingSource"
        }
      ]
    }
  },
  "validation": {
    "requiredPaths": [
      "./src",
      "./assets",
      "./rules",
      "./requirements.txt",
      "./README.md",
      "./project_config.json"
    ],
    "optionalPaths": [
      "./tests",
      "./docs",
      "./logs",
      "./.devcontainer",
      "./web"
    ],
    "configValidation": {
      "enabled": true,
      "strictMode": false,
      "autoFix": false
    }
  },
  "monitoring": {
    "healthCheck": {
      "enabled": true,
      "interval": 300,
      "scripts": [
        "./scripts/health_monitor/health_monitor.py",
        "./scripts/health_monitor/config_validator.py"
      ]
    },
    "metrics": {
      "enabled": true,
      "collectionInterval": 60,
      "retention": 86400
    },
    "alerts": {
      "enabled": true,
      "channels": [
        "log",
        "ui"
      ],
      "thresholds": {
        "cpu": 80,
        "memory": 85,
        "disk": 90
      }
    },
    "sentry": {
      "enabled": true,
      "dsn": "https://4d6820ea296e34011b2e4db3e747b87d@o4510728365015040.ingest.us.sentry.io/4510728434483200",
      "send_default_pii": true,
      "environment": "production"
    }
  },
  "logging": {
    "level": "INFO",
    "format": "%(asctime)s - %(name)s - %(levelname)s - %(message)s",
    "handlers": {
      "console": {
        "enabled": true,
        "level": "WARNING"
      },
      "file": {
        "enabled": true,
        "path": "./logs/app.log",
        "maxSize": "100MB",
        "backupCount": 5
      }
    }
  },
  "frontendRendering": {
    "enabled": true,
    "dataSource": "api/mapping/api_mapping.json",
    "rendering": {
      "mode": "dynamic",
      "templateSource": "api_mapping.json#mappings",
      "components": {
        "charts": "web/static/js/components/charting.js",
        "progress": "web/static/js/components/progress.js",
        "spinner": "web/static/js/components/spinner.js",
        "toast": "web/static/js/components/toast.js",
        "ws": "web/static/js/ws.js"
      }
    },
    "lifecycle": {
      "mount": {
        "actions": [
          "fetchModules",
          "initWS",
          "subscribeStreams"
        ]
      },
      "update": {
        "actions": [
          "handleWSMessage",
          "updateState",
          "reRender"
        ]
      },
      "unmount": {
        "actions": [
          "unsubscribeWS",
          "clearTimers",
          "releaseResources"
        ]
      }
    }
  },
  "apiMapping": {
    "enabled": true,
    "source": "api/mapping/api_mapping.json",
    "reference": "api/config/api_config.json",
    "frontend": {
      "entry": "api/frontend/api.js",
      "authHeader": "Authorization"
    },
    "permissions": {
      "control": "data-feature",
      "attribute": "Permission.applyGuards()"
    }
  },
  "realtime": {
    "websocket": {
      "enabled": true,
      "path": "/ws",
      "channels": [
        "progress",
        "log",
        "data",
        "heartbeat"
      ],
      "reconnect": {
        "enabled": true,
        "maxAttempts": 5,
        "delay": 3000,
        "strategy": "exponentialBackoff"
      },
      "heartbeat": {
        "interval": 30000,
        "timeout": 10000
      }
    },
    "fallback": {
      "polling": {
        "enabled": true,
        "interval": 5000,
        "maxDelay": 30000
      }
    }
  }
}
# 资源和第三方项目 (assets/)

## 概述

`assets/` 文件夹包含了项目所需的所有资源文件、第三方开源项目和媒体数据。

## 目录结构

### models/ - AI模型资源

- **用途**: 存放AI模型文件和权重数据
- **内容**: InsightFace、FaceFusion、Deep-Live-Cam等模型
- **管理**: 自动下载、缓存管理、本地存储

### images/ - 图片资源管理

#### source/ - 源图片

- 用户上传的源图片，用于人脸替换
- 支持格式: JPG, PNG, WebP, BMP
- 文件大小限制: 100MB

#### templates/ - 模板图片

- 预设的模板图片和示例
- 应用启动时自动加载

#### output/ - 输出图片

- 处理后的输出图片
- 自动清理（7天后删除）

### videos/ - 视频资源管理

#### source/ - 源视频

- 用户上传的源视频
- 支持格式: MP4, AVI, MOV, MKV, WebM
- 文件大小限制: 5GB

#### output/ - 输出视频

- 处理后的输出视频
- 自动清理（30天后删除）

### Deep-Live-Cam-main/ - 实时换脸引擎

- **开源项目**: <https://github.com/DeepLiveCam>
- **功能**: 实时摄像头换脸
- **集成方式**: Python模块调用
- **配置**: GPU优先，CPU回退

### facefusion-master/ - 高质量换脸引擎

- **开源项目**: <https://github.com/facefusion/facefusion>
- **功能**: 高质量视频换脸，支持批量处理
- **集成方式**: REST API或命令行
- **配置**: 多质量预设，GPU加速

### iRoopDeepFaceCam-main/ - 表情换脸引擎

- **开源项目**: <https://github.com/iroop>
- **功能**: 表情和姿态跟踪换脸
- **集成方式**: Python模块调用
- **配置**: 表情跟踪，姿态估计

### obs-studio-master/ - 直播录制软件

- **开源项目**: <https://github.com/obsproject/obs-studio>
- **功能**: 专业的直播和录制软件，支持多种输入源
- **集成方式**: 编译安装或二进制分发
- **配置**: 多平台支持，插件扩展

## 第三方项目集成说明

### 集成原则

1. **统一接口**: 所有第三方引擎通过统一的接口调用
2. **错误处理**: 完善的异常处理和回退机制
3. **性能监控**: 实时监控引擎性能和资源使用
4. **版本管理**: 明确版本号和兼容性检查

### 引擎选择逻辑

- **Deep-Live-Cam**: 优先用于实时摄像头场景
- **FaceFusion**: 优先用于高质量视频处理
- **iRoop**: 优先用于表情和姿态换脸

### 回退策略

1. 首选引擎失败 → 备用引擎
2. GPU不可用 → CPU模式
3. 引擎完全失败 → 返回错误信息

## 资源管理

### 存储策略

- **模型文件**: 本地缓存，避免重复下载
- **临时文件**: 处理过程中产生的中间文件
- **输出文件**: 定期清理过期文件

### 权限管理

- **读取权限**: source/, templates/
- **写入权限**: output/, temp/
- **执行权限**: 第三方脚本

### 清理机制

- **临时文件**: 1小时后自动删除
- **输出文件**: 按配置的保留期清理
- **定期任务**: 每天执行一次清理

## 使用指南

### 添加新模型

```python
# 在models目录下放置模型文件
# 更新配置中的模型路径
# 重启应用时会自动加载
```

### 集成新引擎

```python
# 在integrations/下创建新的集成模块
# 实现统一的接口
# 更新assets_config.json
# 添加到引擎选择逻辑中
```

### 资源监控

```python
# 查看存储使用情况
du -sh assets/

# 查看文件数量
find assets/ -type f | wc -l

# 清理过期文件
python scripts/cleanup_assets.py
```

## 注意事项

1. **磁盘空间**: 确保有足够的存储空间（推荐20GB+）
2. **网络连接**: 模型下载需要网络连接
3. **权限设置**: 确保应用有读写相关目录的权限
4. **备份重要文件**: 定期备份重要的输出文件

## 故障排除

### 模型下载失败

- 检查网络连接
- 确认模型URL有效
- 查看日志中的错误信息

### 引擎启动失败

- 检查Python版本兼容性
- 确认依赖包已安装
- 查看GPU/CPU可用性

### 存储空间不足

- 清理临时文件
- 删除过期输出文件
- 增加磁盘空间

## 扩展开发

新增资源类型时请：

1. 在assets_config.json中定义配置
2. 更新assets_README.md文档
3. 实现相应的管理逻辑
4. 添加验证和清理机制

---

_最后更新: 2026-01-21_
